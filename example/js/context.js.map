{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/context-query.js","webpack:///./src/context-style.js","webpack:///./src/context.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","window","contextFeatures","supported","navigator","maxTouchPoints","ContextQuery","query","this","_onchange","_listeners","_queries","_breakQueriesDown","_intervalID","context","matches","_determineMatch","_registerListeners","feature","includes","addEventListener","e","normalised","_performContextCheck","Math","round","Date","getHours","getMinutes","setInterval","acceleration","accel","sqrt","y","x","getBattery","then","battery","level","charging","fname","val","type","callback","push","stack","console","log","toString","splice","removeEventListener","event","elm","defaultPrevented","mixedSigns","arr","symbol","left","right","length","tmpArr","tmpStr","idx","undefined","split","unshift","findClosingBracket","start","str","indexOf","b","tree","queries","createQueryTreeRecursively","obj","q","substring","replace","trim","operator","ra","objName","incdec","prcnt","objct","lt","gt","lteq","gteq","negate","error","isNaN","min","parseFloat","max","lt_gt","a","objVal","abs","evaluateQueriesRecursively","tmp","b1","Number","NEGATIVE_INFINITY","POSITIVE_INFINITY","isInteger","Infinity","dispatchEvent","CustomEvent","detail","target","matchContext","expression","ContextStyle","HTMLElement","super","_arrayOfQueries","_host","document","querySelector","_head","_contextQueryObjectList","style","display","parentNode","host","shadowRoot","getHrefAttr","clearInterval","j","classList","remove","class","attr","inner","innerHTML","instantiateContextQueryObjects","hasAttribute","getAttribute","getURL","response","getContent","url","Promise","resolve","reject","req","XMLHttpRequest","open","onload","status","Error","statusText","onerror","send","factoriseContextQueries","contextQuery","cssClass","cqo","css","onchange","contains","add","styles","selector","localName","properties","appendChild","createTextNode","createElement","id","brackets","sbstrng","str2","newArrayOfQueries","arrayOfSelectors","singleStyles","lastIndexOf","z","classes","attrs","classArr","sc","globalQuery","customElements","define"],"mappings":"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","file":"context.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/**\r\n *\r\n */\r\n// new features structure\r\nwindow.contextFeatures = [\r\n  {\r\n    name: \"light-intensity\",\r\n    value: null,\r\n    supported: \"ondevicelight\" in window ? true : false\r\n  },\r\n  {\r\n    name: \"motion-speed\",\r\n    value: null,\r\n    supported: \"ondevicemotion\" in window ? true : false\r\n  },\r\n  {\r\n    name: \"touch\",\r\n    value: null,\r\n    supported:\r\n      \"ontouchstart\" in window || navigator.maxTouchPoints ? true : false\r\n  },\r\n  { name: \"time\", value: null, supported: true },\r\n  {\r\n    name: \"battery\",\r\n    value: null,\r\n    supported: \"getBattery\" in navigator ? true : false\r\n  },\r\n  {\r\n    name: \"charging-battery\",\r\n    value: null,\r\n    supported: \"getBattery\" in navigator ? true : false\r\n  }\r\n];\r\n\r\nexport default class ContextQuery {\r\n  constructor(query) {\r\n    // 'Private'\r\n    this._onchange = null;\r\n    this._listeners = {};\r\n    this._queries = this._breakQueriesDown(query);\r\n    this._intervalID = {};\r\n    // 'Public'\r\n    this.context = query;\r\n    this.matches = this._determineMatch();\r\n    // attach event listeners\r\n    this._registerListeners();\r\n  }\r\n\r\n  _registerListeners() {\r\n    for (let feature of window.contextFeatures) {\r\n      if (feature.supported && this.context.includes(feature.name)) {\r\n        switch (feature.name) {\r\n          case \"light-intensity\":\r\n            window.addEventListener(\"devicelight\", e => {\r\n              let normalised = e.value / 10; // normalise range from 0 to 100, max value on nexus 4 is 1000\r\n              this._performContextCheck(\r\n                \"light-intensity\",\r\n                Math.round(normalised)\r\n              );\r\n            });\r\n            break;\r\n          case \"touch\":\r\n            this._performContextCheck(\r\n              \"touch\",\r\n              \"ontouchstart\" in window || navigator.maxTouchPoints\r\n                ? true\r\n                : false\r\n            );\r\n            break;\r\n          case \"time\":\r\n            this._performContextCheck(\r\n              \"time\",\r\n              new Date().getHours() * 60 + new Date().getMinutes()\r\n            );\r\n            this._intervalID = setInterval(() => {\r\n              this._performContextCheck(\r\n                \"time\",\r\n                new Date().getHours() * 60 + new Date().getMinutes()\r\n              );\r\n            }, 1000);\r\n            break;\r\n          case \"motion-speed\":\r\n            let acceleration = 0;\r\n            window.addEventListener(\"devicemotion\", function(e) {\r\n              let accel = Math.round(\r\n                Math.sqrt(\r\n                  e.acceleration.y * e.acceleration.y +\r\n                    e.acceleration.x * e.acceleration.x\r\n                )\r\n              );\r\n              if (accel > acceleration || accel == 0) {\r\n                acceleration = accel;\r\n                this._performContextCheck(\"motion-speed\", accel);\r\n              }\r\n            });\r\n            break;\r\n          case \"battery\":\r\n            navigator.getBattery().then(battery => {\r\n              this._performContextCheck(\"battery\", battery.level * 100);\r\n              battery.addEventListener(\"levelchange\", () => {\r\n                this._performContextCheck(\"battery\", battery.level * 100);\r\n              });\r\n            });\r\n            break;\r\n          case \"charging-battery\":\r\n            navigator.getBattery().then(battery => {\r\n              // Perform check on resolved promise then add change listener\r\n              this._performContextCheck(\"charging-battery\", battery.charging);\r\n              battery.addEventListener(\"chargingchange\", () => {\r\n                this._performContextCheck(\"charging-battery\", battery.charging);\r\n              });\r\n            });\r\n            break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {string} fname the name of the feature\r\n   * @param {number} val the new numeric value\r\n   */\r\n  _performContextCheck(fname, val) {\r\n    // update the values passed by the listeners of this._registerListeners() in the window.contextFeatures object\r\n    for (let i of window.contextFeatures) {\r\n      if (i.name == fname) {\r\n        i.value = val;\r\n      }\r\n    }\r\n    this._determineMatch();\r\n  }\r\n\r\n  /**\r\n   * @param {string} type\r\n   * @param {function} callback\r\n   */\r\n\r\n  addEventListener(type, callback) {\r\n    if (!(type in this._listeners)) {\r\n      this._listeners[type] = [];\r\n    }\r\n    this._listeners[type].push(callback);\r\n  }\r\n\r\n  /**\r\n   * @param {function} callback\r\n   */\r\n\r\n  addListener(callback) {\r\n    this.addEventListener(\"change\", callback);\r\n  }\r\n\r\n  /**\r\n   * @param {string} type\r\n   * @param {function} callback\r\n   */\r\n\r\n  removeEventListener(type, callback) {\r\n    if (!(type in this._listeners)) {\r\n      return;\r\n    }\r\n    let stack = this._listeners[type];\r\n\r\n    for (let i in stack) {\r\n      console.log(stack[i]);\r\n      if (stack[i].toString() === callback.toString()) {\r\n        stack.splice(i, 1);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {function} callback\r\n   */\r\n\r\n  removeListener(callback) {\r\n    this.removeEventListener(\"change\", callback);\r\n  }\r\n\r\n  /**\r\n   * @param {CustomEvent} event\r\n   */\r\n\r\n  dispatchEvent(event) {\r\n    if (!(event.type in this._listeners)) {\r\n      return true;\r\n    }\r\n    let stack = this._listeners[event.type];\r\n\r\n    //event.target = this;\r\n    for (let elm of stack) {\r\n      elm.call(this, event);\r\n    }\r\n    return !event.defaultPrevented;\r\n  }\r\n\r\n  /**\r\n   * @param {function} callback\r\n   */\r\n\r\n  set onchange(callback) {\r\n    if (typeof callback == \"function\") {\r\n      this.removeEventListener(\"change\", this._onchange);\r\n      this._onchange = callback;\r\n      this.addEventListener(\"change\", callback);\r\n    }\r\n  }\r\n\r\n  get onchange() {\r\n    return this._onchange;\r\n  }\r\n\r\n  /**\r\n   * @param {string} context\r\n   */\r\n  _breakQueriesDown(context) {\r\n    /**\r\n     * @param {array} arr the resulting array after having splitted the query using <= or >=\r\n     * @param {string} symbol the character to look up for in the passed array, either < or >\r\n     */\r\n    function mixedSigns(arr, symbol) {\r\n      let o = { left: false, right: false };\r\n      if (arr.length == 2) {\r\n        let left = false,\r\n          tmpArr,\r\n          tmpStr;\r\n        for (let idx in arr) {\r\n          // check if symbol is present\r\n          if (arr[idx].includes(symbol)) {\r\n            tmpStr = arr[idx];\r\n            arr.splice(idx, 1);\r\n            if (idx == 0) {\r\n              left = true;\r\n            }\r\n          }\r\n        }\r\n        // if tmpStr has been assigned value\r\n        if (tmpStr != undefined) {\r\n          tmpArr = tmpStr.split(symbol);\r\n          if (left) {\r\n            arr.unshift(tmpArr[1]);\r\n            arr.unshift(tmpArr[0]);\r\n            if (symbol === \"<\") {\r\n              o.left = true;\r\n            } else {\r\n              o.right = true;\r\n            }\r\n          } else {\r\n            arr.push(tmpArr[0]);\r\n            arr.push(tmpArr[1]);\r\n            if (symbol === \"<\") {\r\n              o.right = true;\r\n            } else {\r\n              o.left = true;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return o;\r\n    }\r\n\r\n    /**\r\n     * @param {string} brackets the type of brackets as pair [],{},()\r\n     * @param {string} str the string where the brackets are to be found\r\n     */\r\n\r\n    function findClosingBracket(start, str) {\r\n      let c = str.indexOf(\"(\", start);\r\n      let i = 1;\r\n      while (i > 0) {\r\n        let b = str[++c];\r\n        if (b == \"(\") {\r\n          i++;\r\n        } else if (b == \")\") {\r\n          i--;\r\n        }\r\n      }\r\n      return c;\r\n    }\r\n\r\n    let tree = { queries: [] };\r\n\r\n    /**\r\n     * @param {object} obj an object representing all relations between the queries of which the context is composed\r\n     * such an object has the following structure:\r\n     * {\r\n     *  operator: 'and' | 'or' // optional: the operator combining two or more queries\r\n     *  negate: true // optional: whether the expression has been prefixed with 'not'\r\n     *  queries: [ // array of objects\r\n     *      { // an object representing a query\r\n     *          context: '120 < time < 600', // the query\r\n     *          feature: 'time', // the name of the feature\r\n     *          lt_gt: { // optional when using < or >\r\n     *              left: true | false,\r\n     *              right: true | false\r\n     *          },\r\n     *          max: 600, // optional: the max value specified in the query\r\n     *          min: 120, // optional: the min value specified in the query\r\n     *          abs: true | 'string' // optional: whether the query has an absolute value\r\n     *      },\r\n     *      { // an object with the same structure as its parent\r\n     *          operator: 'and',\r\n     *          queries: [\r\n     *              ...\r\n     *          ]\r\n     *      }\r\n     *  ]\r\n     * }\r\n     * @param {string} context the composed context\r\n     */\r\n\r\n    function createQueryTreeRecursively(obj, context) {\r\n      let q = \"\",\r\n        idx = context.indexOf(\"(\");\r\n\r\n      // check if the expression has prefix 'not', if so set idx to 0\r\n      if (context.substring(idx - 3, idx) === \"not\") {\r\n        idx = idx - 3;\r\n      }\r\n      // if idx != 0 we're dealing with an operator\r\n      if (idx != 0) {\r\n        q = context.substring(0, idx);\r\n      } else {\r\n        q = context.substring(idx, findClosingBracket(idx, context) + 1);\r\n      }\r\n      // replace the substring\r\n      context = context.replace(q, \"\");\r\n      q = q.trim();\r\n\r\n      if (q !== \"\") {\r\n        if (q == \"or\" || q == \"and\") {\r\n          obj.operator = q;\r\n        } else {\r\n          if (!q.includes(\"and\") && !q.includes(\"or\")) {\r\n            let ra,\r\n              prcnt = \"%\",\r\n              objct = {},\r\n              objName,\r\n              incdec,\r\n              lt = \"<\",\r\n              gt = \">\",\r\n              lteq = \"<=\",\r\n              gteq = \">=\";\r\n            if (q.substring(q.indexOf(\"(\") - 3, q.indexOf(\"(\")) === \"not\") {\r\n              objct.negate = true;\r\n            }\r\n            objct.context = q.substring(q.indexOf(\"(\") + 1, q.indexOf(\")\"));\r\n            if (objct.context.includes(lt) || objct.context.includes(gt)) {\r\n              if (objct.context.includes(lt) && objct.context.includes(gt)) {\r\n                console.error(\r\n                  \"you have mixed the greater than and less than symbol in an expression!\"\r\n                );\r\n                return;\r\n              }\r\n              if (objct.context.includes(lt)) {\r\n                if (objct.context.includes(lteq)) {\r\n                  ra = objct.context.split(lteq);\r\n                  incdec = mixedSigns(ra, lt);\r\n                } else {\r\n                  ra = objct.context.split(lt);\r\n                  incdec = { left: true, right: true };\r\n                }\r\n                if (ra.length == 2) {\r\n                  if (ra[0].includes(prcnt) || !isNaN(ra[0])) {\r\n                    objct.min = parseFloat(ra[0]);\r\n                    objct.feature = ra[1].trim();\r\n                  } else {\r\n                    objct.max = parseFloat(ra[1]);\r\n                    objct.feature = ra[0].trim();\r\n                  }\r\n                } else {\r\n                  objct.feature = ra[1].trim();\r\n                  objct.min = parseFloat(ra[0]);\r\n                  objct.max = parseFloat(ra[2]);\r\n                }\r\n\r\n                if (incdec.left || incdec.right) {\r\n                  objct.lt_gt = incdec;\r\n                }\r\n                q = {};\r\n                q = objct;\r\n              }\r\n              if (objct.context.includes(gt)) {\r\n                if (objct.context.includes(gteq)) {\r\n                  ra = objct.context.split(gteq);\r\n                  incdec = mixedSigns(ra, gt);\r\n                } else {\r\n                  ra = objct.context.split(gt);\r\n                  incdec = { left: true, right: true };\r\n                }\r\n                if (ra.length == 2) {\r\n                  if (ra[0].includes(prcnt) || !isNaN(ra[0])) {\r\n                    objct.max = parseFloat(ra[0]);\r\n                    objct.feature = ra[1].trim();\r\n                  } else {\r\n                    objct.min = parseFloat(ra[1]);\r\n                    objct.feature = ra[0].trim();\r\n                  }\r\n                } else {\r\n                  objct.feature = ra[1].trim();\r\n                  objct.max = parseFloat(ra[0]);\r\n                  objct.min = parseFloat(ra[2]);\r\n                }\r\n                if (incdec.left || incdec.right) {\r\n                  objct.lt_gt = incdec;\r\n                }\r\n                q = {};\r\n                q = objct;\r\n              }\r\n            } else if (objct.context.includes(\":\")) {\r\n              let a, objVal;\r\n              a = objct.context.split(/\\s*:\\s*/);\r\n              objName = a[0].trim();\r\n              objct.feature = objName;\r\n              objVal = parseFloat(a[1]);\r\n\r\n              if (objName.includes(\"min-\") || objName.includes(\"max-\")) {\r\n                objName = objName.replace(\"min-\", \"\");\r\n                objName = objName.replace(\"max-\", \"\");\r\n                objct.feature = objName;\r\n                if (a[0].includes(\"min-\")) {\r\n                  objct.min = objVal;\r\n                }\r\n                if (a[0].includes(\"max-\")) {\r\n                  objct.max = objVal;\r\n                }\r\n                q = {};\r\n                q = objct;\r\n              } else {\r\n                objct.abs = objVal;\r\n                q = {};\r\n                q = objct;\r\n              }\r\n            } else {\r\n              if (objct.context) {\r\n                objct.feature = objct.context;\r\n                objct.abs = true;\r\n                q = {};\r\n                q = objct;\r\n              }\r\n            }\r\n          }\r\n          obj.queries.push(q);\r\n        }\r\n        // carry on recursively with the rest of the string\r\n        createQueryTreeRecursively(obj, context);\r\n      } else {\r\n        for (let i in obj.queries) {\r\n          if (typeof obj.queries[i] === \"string\") {\r\n            context = obj.queries[i];\r\n            obj.queries[i] = { queries: [] };\r\n            if (\r\n              context.substring(\r\n                context.indexOf(\"(\") - 3,\r\n                context.indexOf(\"(\")\r\n              ) === \"not\"\r\n            ) {\r\n              context = context.replace(\"not\", \"\");\r\n              obj.queries[i].negate = true;\r\n            }\r\n            context = context.substring(\r\n              context.indexOf(\"(\") + 1,\r\n              findClosingBracket(context.indexOf(\"(\"), context)\r\n            );\r\n\r\n            createQueryTreeRecursively(obj.queries[i], context);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    createQueryTreeRecursively(tree, context.trim());\r\n\r\n    return tree;\r\n  }\r\n\r\n  _determineMatch() {\r\n    /**\r\n     * @param {object} obj the object representing the combined queries in a tree-like structure\r\n     */\r\n    function evaluateQueriesRecursively(obj) {\r\n      let tmp, operator;\r\n\r\n      // check if the combined query has been prefixed with 'not', if so invert the operators\r\n      if (obj.hasOwnProperty(\"negate\")) {\r\n        if (obj.operator === \"and\") {\r\n          operator = \"or\";\r\n        } else if (obj.operator === \"or\") {\r\n          operator = \"and\";\r\n        }\r\n      } else {\r\n        operator = obj.operator;\r\n      }\r\n\r\n      for (let q of obj.queries) {\r\n        if (!q.hasOwnProperty(\"queries\")) {\r\n          let b1 = true,\r\n            min = Number.NEGATIVE_INFINITY,\r\n            max = Number.POSITIVE_INFINITY;\r\n          for (let feature of window.contextFeatures) {\r\n            if (feature.name === q.feature) {\r\n              // Compare to values stored in Features object\r\n              if (feature.supported) {\r\n                // has an unique value either numeric or boolean\r\n                if (q.hasOwnProperty(\"abs\")) {\r\n                  if (Number.isInteger(q.abs)) {\r\n                    if (feature.value != q.abs) {\r\n                      b1 = false;\r\n                    }\r\n                  } else {\r\n                    if (!feature.value) {\r\n                      b1 = false;\r\n                    }\r\n                  }\r\n                } else {\r\n                  // Value is in range\r\n                  if (q.hasOwnProperty(\"min\")) {\r\n                    min = q.min;\r\n                  }\r\n                  if (q.hasOwnProperty(\"max\")) {\r\n                    max = q.max;\r\n                  }\r\n                  if (q.hasOwnProperty(\"lt_gt\")) {\r\n                    if (q.lt_gt.left) {\r\n                      ++min;\r\n                    }\r\n                    if (q.lt_gt.right) {\r\n                      --max;\r\n                    }\r\n                  }\r\n                  if (min != -Infinity || max != Infinity) {\r\n                    if (feature.value < min || max < feature.value) {\r\n                      b1 = false;\r\n                    }\r\n                  }\r\n                }\r\n                if (q.hasOwnProperty(\"negate\")) {\r\n                  b1 = !b1;\r\n                }\r\n              } else {\r\n                b1 = false;\r\n              }\r\n            }\r\n          }\r\n          if (obj.hasOwnProperty(\"negate\")) {\r\n            b1 = !b1;\r\n          }\r\n\r\n          if (obj.queries.indexOf(q) === 0) {\r\n            tmp = b1;\r\n          } else {\r\n            if (operator === \"and\") {\r\n              tmp = tmp && b1;\r\n            }\r\n            if (operator === \"or\") {\r\n              tmp = tmp || b1;\r\n            }\r\n          }\r\n        } else {\r\n          if (obj.queries.indexOf(q) !== 0) {\r\n            if (operator === \"and\") {\r\n              tmp = tmp && evaluateQueriesRecursively(q);\r\n            }\r\n            if (operator === \"or\") {\r\n              tmp = tmp || evaluateQueriesRecursively(q);\r\n            }\r\n          } else {\r\n            tmp = evaluateQueriesRecursively(q);\r\n          }\r\n        }\r\n      }\r\n      return tmp;\r\n    }\r\n\r\n    let b = evaluateQueriesRecursively(this._queries);\r\n\r\n    if (b != this.matches) {\r\n      if (this.matches == undefined) {\r\n        return b;\r\n      } else {\r\n        this.matches = b;\r\n        this.dispatchEvent(\r\n          new CustomEvent(\"change\", { detail: { matches: b, target: this } })\r\n        );\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// matchContext function to instantiate ContextQueryList Object with -- let varname = window.matchContext(\"(touch)\") --\r\nwindow.matchContext = function(expression) {\r\n  let o = new ContextQuery(expression);\r\n  //console.log(o);\r\n  return o;\r\n};\r\n","/**\r\n *\r\n */\r\nexport default class ContextStyle extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n    this._arrayOfQueries = [];\r\n    this._host = document.querySelector(\"html\");\r\n    this._head = document.querySelector(\"head\");\r\n    this._contextQueryObjectList = [];\r\n  }\r\n\r\n  connectedCallback() {\r\n    this.style.display = \"none\";\r\n    if (this.parentNode.host != undefined) {\r\n      if (!this.parentNode.host.shadowRoot.querySelector(\"slot\")) {\r\n        this._host = this.parentNode.host;\r\n        this._head = this._host.shadowRoot;\r\n      }\r\n    }\r\n    this.getHrefAttr();\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    for (let i in this._contextQueryObjectList) {\r\n      if (this._contextQueryObjectList[i]._intervalID != undefined) {\r\n        clearInterval(this._contextQueryObjectList[i]._intervalID);\r\n      }\r\n      this._contextQueryObjectList[i] = null;\r\n      delete this._contextQueryObjectList[i];\r\n    }\r\n    for (let j of this._arrayOfQueries) {\r\n      this._host.classList.remove(j.class);\r\n    }\r\n    this._contextQueryObjectList.length = 0;\r\n    //console.log(this._contextQueryObjectList);\r\n  }\r\n\r\n  /**\r\n   * @param {string} attr - the query from the \"context\" attribute\r\n   */\r\n  getContent(attr) {\r\n    let inner = this.innerHTML;\r\n    if (inner.trim() != \"\") {\r\n      inner = inner.replace(/&gt;/g, \">\").replace(/&lt;/g, \"<\");\r\n      this.instantiateContextQueryObjects(inner.trim(), attr);\r\n    } else {\r\n      console.error(\r\n        \"Context-Styles have not been declared, please use the href attribute or write them directly in the context-style tag.\"\r\n      );\r\n    }\r\n  }\r\n\r\n  getHrefAttr() {\r\n    let attr = false;\r\n    if (this.hasAttribute(\"context\") && this.getAttribute(\"context\") != \"\") {\r\n      attr = this.getAttribute(\"context\");\r\n    }\r\n    if (this.hasAttribute(\"href\") && this.getAttribute(\"href\") != \"\") {\r\n      this.getURL(this.getAttribute(\"href\")).then(\r\n        response => {\r\n          this.instantiateContextQueryObjects(response, attr);\r\n          //this.content(attr);\r\n        },\r\n        error => {\r\n          console.error(\"Failed!\", error);\r\n        }\r\n      );\r\n    } else {\r\n      //console.log('href empty or non existent');\r\n      this.getContent(attr);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {string} url - the link to an external context query sheet\r\n   */\r\n\r\n  getURL(url) {\r\n    return new Promise(function(resolve, reject) {\r\n      var req = new XMLHttpRequest();\r\n      req.open(\"GET\", url);\r\n      req.onload = function() {\r\n        if (req.status == 200) {\r\n          resolve(req.response);\r\n        } else {\r\n          reject(Error(req.statusText));\r\n        }\r\n      };\r\n      req.onerror = function() {\r\n        reject(Error(\"Network Error\"));\r\n      };\r\n      req.send();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {string} str the styles found inside the <context-style> custom element\r\n   * @param {string} attr the query of the \"context\" attribute\r\n   */\r\n\r\n  instantiateContextQueryObjects(str, attr) {\r\n    this.factoriseContextQueries(str, attr);\r\n    for (let contextQuery of this._arrayOfQueries) {\r\n      // Generate unique class;\r\n      // unary operator in +new Date equivalent to Number(new Date)\r\n      const cssClass =\r\n        \"css-ctx-queries-\" +\r\n        (+new Date()).toString(36) +\r\n        this._arrayOfQueries.indexOf(contextQuery);\r\n      contextQuery.class = cssClass;\r\n      // Instantiate Object with new constructor\r\n      let cqo = window.matchContext(contextQuery.expression),\r\n        css = \"\";\r\n      // Define a callback on change\r\n      cqo.onchange = e => {\r\n        if (e != undefined) {\r\n          console.log(e);\r\n        }\r\n        if (cqo.matches) {\r\n          if (!this._host.classList.contains(cssClass)) {\r\n            this._host.classList.add(cssClass);\r\n          }\r\n        } else {\r\n          if (this._host.classList.contains(cssClass)) {\r\n            this._host.classList.remove(cssClass);\r\n          }\r\n        }\r\n      };\r\n      // trigger the callback for the first time\r\n      cqo.onchange();\r\n\r\n      this._contextQueryObjectList.push(cqo);\r\n\r\n      for (let style of contextQuery.styles) {\r\n        let key = style.selector;\r\n        if (this._host.shadowRoot != undefined) {\r\n          if (!this._host.shadowRoot.querySelector(\"slot\")) {\r\n            if (key == \":host\") {\r\n              css += \":host(.\" + cssClass + \") \" + \"{\" + style.properties + \"}\";\r\n            } else {\r\n              css +=\r\n                \":host(.\" +\r\n                cssClass +\r\n                \") \" +\r\n                key.replace(\"&gt;\", \">\") +\r\n                \"{\" +\r\n                style.properties +\r\n                \"}\";\r\n            }\r\n          } else {\r\n            css +=\r\n              \".\" +\r\n              cssClass +\r\n              \" \" +\r\n              this._host.localName +\r\n              \" \" +\r\n              key.replace(\"&gt;\", \">\") +\r\n              \"{\" +\r\n              style.properties +\r\n              \"}\";\r\n          }\r\n        } else {\r\n          if (key === \"html\") {\r\n            css += key + \".\" + cssClass + \"{\" + style.properties + \"}\";\r\n          } else {\r\n            css +=\r\n              \".\" +\r\n              cssClass +\r\n              \" \" +\r\n              key.replace(\"&gt;\", \">\") +\r\n              \"{\" +\r\n              style.properties +\r\n              \"}\";\r\n          }\r\n        }\r\n      }\r\n\r\n      if (this._head.querySelector(\"#cssCtxQueriesStyleTag\")) {\r\n        this._head\r\n          .querySelector(\"#cssCtxQueriesStyleTag\")\r\n          .appendChild(document.createTextNode(css));\r\n      } else {\r\n        let style = document.createElement(\"style\");\r\n        style.id = \"cssCtxQueriesStyleTag\";\r\n        style.appendChild(document.createTextNode(css));\r\n        this._head.appendChild(style);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {string} brackets the type of brackets as pair [],{},()\r\n   * @param {string} str the string where the brackets are to be found\r\n   */\r\n\r\n  findClosingBracket(brackets, str) {\r\n    let c = str.indexOf(brackets[0], str.indexOf(\"@context\"));\r\n    let i = 1;\r\n    while (i > 0) {\r\n      let b = str[++c];\r\n      if (b == brackets[0]) {\r\n        i++;\r\n      } else if (b == brackets[1]) {\r\n        i--;\r\n      }\r\n    }\r\n    return c;\r\n  }\r\n\r\n  /**\r\n   * @param {string} str - the content of the <context-style> custom element\r\n   * @param {string} attr - the content of the context attribute, false if the context attribute is empty\r\n   */\r\n\r\n  factoriseContextQueries(str, attr) {\r\n    if (str.includes(\"@context\")) {\r\n      let sbstrng = str.substring(\r\n        str.indexOf(\"@context\"),\r\n        this.findClosingBracket(\"{}\", str) + 1\r\n      );\r\n      let str2 = str.replace(sbstrng, \"\");\r\n      str2 = str2.trim();\r\n      this._arrayOfQueries.push(sbstrng);\r\n      this.factoriseContextQueries(str2, attr);\r\n    } else {\r\n      // push the query from the context attribute into _arrayOfQueries\r\n      if (attr != false) {\r\n        this._arrayOfQueries.push(\"@context \" + attr + \" {\" + str + \"}\");\r\n      }\r\n      let newArrayOfQueries = [];\r\n      for (let elm of this._arrayOfQueries) {\r\n        let expression = elm.substring(8, elm.indexOf(\"{\"));\r\n        let styles = elm.substring(elm.indexOf(\"{\") + 1, elm.lastIndexOf(\"}\"));\r\n        let arrayOfSelectors = [],\r\n          singleStyles = styles.split(/\\s*}\\s*/);\r\n        for (let z of singleStyles) {\r\n          let classes, attrs, classArr;\r\n          classes = z.substring(0, z.indexOf(\"{\"));\r\n          attrs = z.substring(z.indexOf(\"{\") + 1);\r\n          classArr = classes.split(/\\s*,\\s*/);\r\n          for (let sc of classArr) {\r\n            let obj = { selector: sc.trim(), properties: attrs.trim() };\r\n            if (obj.selector != \"\" || obj.properties !== \"\") {\r\n              arrayOfSelectors.push(obj);\r\n            }\r\n          }\r\n        }\r\n\r\n        newArrayOfQueries.push({\r\n          expression: expression.trim(),\r\n          styles: arrayOfSelectors\r\n        });\r\n      }\r\n\r\n      // factorise all objects in _arrayOfQueries only if there's a global query and more than one query in total\r\n      if (attr != false) {\r\n        let globalQuery =\r\n          newArrayOfQueries[newArrayOfQueries.length - 1].expression;\r\n        if (globalQuery.includes(\"or\") || globalQuery.includes(\",\")) {\r\n          globalQuery = \"(\" + globalQuery + \")\";\r\n        }\r\n        for (let i = 0; i < newArrayOfQueries.length - 1; i++) {\r\n          if (\r\n            newArrayOfQueries[i].expression.includes(\"or\") ||\r\n            newArrayOfQueries[i].expression.includes(\",\")\r\n          ) {\r\n            newArrayOfQueries[i].expression =\r\n              \"(\" + newArrayOfQueries[i].expression + \")\";\r\n          }\r\n          newArrayOfQueries[i].expression += \" and \" + globalQuery;\r\n        }\r\n      }\r\n      this._arrayOfQueries = [];\r\n      // reorganise arrayOfQueries\r\n      for (let i of newArrayOfQueries) {\r\n        if (i.styles.length > 0) {\r\n          this._arrayOfQueries.push(i);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function() {\r\n  window.customElements.define(\"context-style\", ContextStyle);\r\n});\r\n","import ContextQuery from \"./context-query\";\r\nimport ContextStyle from \"./context-style\";\r\n\r\nexport { ContextQuery, ContextStyle };\r\n"],"sourceRoot":""}