!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),window.contextFeatures=[{name:"light-intensity",value:null,supported:"ondevicelight"in window},{name:"motion-speed",value:null,supported:"ondevicemotion"in window},{name:"touch",value:null,supported:!!("ontouchstart"in window||navigator.maxTouchPoints)},{name:"time",value:null,supported:!0},{name:"battery",value:null,supported:"getBattery"in navigator},{name:"charging-battery",value:null,supported:"getBattery"in navigator}];class r{constructor(e){this._onchange=null,this._listeners={},this._queries=this._breakQueriesDown(e),this._intervalID={},this.context=e,this.matches=this._determineMatch(),this._registerListeners()}_registerListeners(){for(let e of window.contextFeatures)if(e.supported&&this.context.includes(e.name))switch(e.name){case"light-intensity":window.addEventListener("devicelight",e=>{let t=e.value/10;this._performContextCheck("light-intensity",Math.round(t))});break;case"touch":this._performContextCheck("touch",!!("ontouchstart"in window||navigator.maxTouchPoints));break;case"time":this._performContextCheck("time",60*(new Date).getHours()+(new Date).getMinutes()),this._intervalID=setInterval(()=>{this._performContextCheck("time",60*(new Date).getHours()+(new Date).getMinutes())},1e3);break;case"motion-speed":let t=0;window.addEventListener("devicemotion",function(e){let n=Math.round(Math.sqrt(e.acceleration.y*e.acceleration.y+e.acceleration.x*e.acceleration.x));(n>t||0==n)&&(t=n,this._performContextCheck("motion-speed",n))});break;case"battery":navigator.getBattery().then(e=>{this._performContextCheck("battery",100*e.level),e.addEventListener("levelchange",()=>{this._performContextCheck("battery",100*e.level)})});break;case"charging-battery":navigator.getBattery().then(e=>{this._performContextCheck("charging-battery",e.charging),e.addEventListener("chargingchange",()=>{this._performContextCheck("charging-battery",e.charging)})})}}_performContextCheck(e,t){for(let n of window.contextFeatures)n.name==e&&(n.value=t);this._determineMatch()}addEventListener(e,t){e in this._listeners||(this._listeners[e]=[]),this._listeners[e].push(t)}addListener(e){this.addEventListener("change",e)}removeEventListener(e,t){if(!(e in this._listeners))return;let n=this._listeners[e];for(let e in n)if(console.log(n[e]),n[e].toString()===t.toString())return void n.splice(e,1)}removeListener(e){this.removeEventListener("change",e)}dispatchEvent(e){if(!(e.type in this._listeners))return!0;let t=this._listeners[e.type];for(let n of t)n.call(this,e);return!e.defaultPrevented}set onchange(e){"function"==typeof e&&(this.removeEventListener("change",this._onchange),this._onchange=e,this.addEventListener("change",e))}get onchange(){return this._onchange}_breakQueriesDown(e){function t(e,t){let n={left:!1,right:!1};if(2==e.length){let r,s,i=!1;for(let n in e)e[n].includes(t)&&(s=e[n],e.splice(n,1),0==n&&(i=!0));null!=s&&(r=s.split(t),i?(e.unshift(r[1]),e.unshift(r[0]),"<"===t?n.left=!0:n.right=!0):(e.push(r[0]),e.push(r[1]),"<"===t?n.right=!0:n.left=!0))}return n}function n(e,t){let n=t.indexOf("(",e),r=1;for(;r>0;){let e=t[++n];"("==e?r++:")"==e&&r--}return n}let r={queries:[]};return function e(r,s){let i="",o=s.indexOf("(");if("not"===s.substring(o-3,o)&&(o-=3),i=0!=o?s.substring(0,o):s.substring(o,n(o,s)+1),s=s.replace(i,""),""!==(i=i.trim())){if("or"==i||"and"==i)r.operator=i;else{if(!i.includes("and")&&!i.includes("or")){let e,n,r,s="%",o={},a="<",l=">",c="<=",u=">=";if("not"===i.substring(i.indexOf("(")-3,i.indexOf("("))&&(o.negate=!0),o.context=i.substring(i.indexOf("(")+1,i.indexOf(")")),o.context.includes(a)||o.context.includes(l)){if(o.context.includes(a)&&o.context.includes(l))return void console.error("you have mixed the greater than and less than symbol in an expression!");o.context.includes(a)&&(o.context.includes(c)?r=t(e=o.context.split(c),a):(e=o.context.split(a),r={left:!0,right:!0}),2==e.length?e[0].includes(s)||!isNaN(e[0])?(o.min=parseFloat(e[0]),o.feature=e[1].trim()):(o.max=parseFloat(e[1]),o.feature=e[0].trim()):(o.feature=e[1].trim(),o.min=parseFloat(e[0]),o.max=parseFloat(e[2])),(r.left||r.right)&&(o.lt_gt=r),i={},i=o),o.context.includes(l)&&(o.context.includes(u)?r=t(e=o.context.split(u),l):(e=o.context.split(l),r={left:!0,right:!0}),2==e.length?e[0].includes(s)||!isNaN(e[0])?(o.max=parseFloat(e[0]),o.feature=e[1].trim()):(o.min=parseFloat(e[1]),o.feature=e[0].trim()):(o.feature=e[1].trim(),o.max=parseFloat(e[0]),o.min=parseFloat(e[2])),(r.left||r.right)&&(o.lt_gt=r),i={},i=o)}else if(o.context.includes(":")){let e,t;n=(e=o.context.split(/\s*:\s*/))[0].trim(),o.feature=n,t=parseFloat(e[1]),n.includes("min-")||n.includes("max-")?(n=(n=n.replace("min-","")).replace("max-",""),o.feature=n,e[0].includes("min-")&&(o.min=t),e[0].includes("max-")&&(o.max=t),i={},i=o):(o.abs=t,i={},i=o)}else o.context&&(o.feature=o.context,o.abs=!0,i={},i=o)}r.queries.push(i)}e(r,s)}else for(let t in r.queries)"string"==typeof r.queries[t]&&(s=r.queries[t],r.queries[t]={queries:[]},"not"===s.substring(s.indexOf("(")-3,s.indexOf("("))&&(s=s.replace("not",""),r.queries[t].negate=!0),s=s.substring(s.indexOf("(")+1,n(s.indexOf("("),s)),e(r.queries[t],s))}(r,e.trim()),r}_determineMatch(){let e=function e(t){let n,r;t.hasOwnProperty("negate")?"and"===t.operator?r="or":"or"===t.operator&&(r="and"):r=t.operator;for(let s of t.queries)if(s.hasOwnProperty("queries"))0!==t.queries.indexOf(s)?("and"===r&&(n=n&&e(s)),"or"===r&&(n=n||e(s))):n=e(s);else{let e=!0,i=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY;for(let t of window.contextFeatures)t.name===s.feature&&(t.supported?(s.hasOwnProperty("abs")?Number.isInteger(s.abs)?t.value!=s.abs&&(e=!1):t.value||(e=!1):(s.hasOwnProperty("min")&&(i=s.min),s.hasOwnProperty("max")&&(o=s.max),s.hasOwnProperty("lt_gt")&&(s.lt_gt.left&&++i,s.lt_gt.right&&--o),i==-1/0&&o==1/0||(t.value<i||o<t.value)&&(e=!1)),s.hasOwnProperty("negate")&&(e=!e)):e=!1);t.hasOwnProperty("negate")&&(e=!e),0===t.queries.indexOf(s)?n=e:("and"===r&&(n=n&&e),"or"===r&&(n=n||e))}return n}(this._queries);if(e!=this.matches){if(null==this.matches)return e;this.matches=e,this.dispatchEvent(new CustomEvent("change",{detail:{matches:e,target:this}}))}}}window.matchContext=function(e){return new r(e)};class s extends HTMLElement{constructor(){super(),this._arrayOfQueries=[],this._host=document.querySelector("html"),this._head=document.querySelector("head"),this._contextQueryObjectList=[]}connectedCallback(){this.style.display="none",null!=this.parentNode.host&&(this.parentNode.host.shadowRoot.querySelector("slot")||(this._host=this.parentNode.host,this._head=this._host.shadowRoot)),this.getHrefAttr()}disconnectedCallback(){for(let e in this._contextQueryObjectList)null!=this._contextQueryObjectList[e]._intervalID&&clearInterval(this._contextQueryObjectList[e]._intervalID),this._contextQueryObjectList[e]=null,delete this._contextQueryObjectList[e];for(let e of this._arrayOfQueries)this._host.classList.remove(e.class);this._contextQueryObjectList.length=0}getContent(e){let t=this.innerHTML;""!=t.trim()?(t=t.replace(/&gt;/g,">").replace(/&lt;/g,"<"),this.instantiateContextQueryObjects(t.trim(),e)):console.error("Context-Styles have not been declared, please use the href attribute or write them directly in the context-style tag.")}getHrefAttr(){let e=!1;this.hasAttribute("context")&&""!=this.getAttribute("context")&&(e=this.getAttribute("context")),this.hasAttribute("href")&&""!=this.getAttribute("href")?this.getURL(this.getAttribute("href")).then(t=>{this.instantiateContextQueryObjects(t,e)},e=>{console.error("Failed!",e)}):this.getContent(e)}getURL(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e),r.onload=function(){200==r.status?t(r.response):n(Error(r.statusText))},r.onerror=function(){n(Error("Network Error"))},r.send()})}instantiateContextQueryObjects(e,t){this.factoriseContextQueries(e,t);for(let e of this._arrayOfQueries){const t="css-ctx-queries-"+(+new Date).toString(36)+this._arrayOfQueries.indexOf(e);e.class=t;let n=window.matchContext(e.expression),r="";n.onchange=e=>{null!=e&&console.log(e),n.matches?this._host.classList.contains(t)||this._host.classList.add(t):this._host.classList.contains(t)&&this._host.classList.remove(t)},n.onchange(),this._contextQueryObjectList.push(n);for(let n of e.styles){let e=n.selector;null!=this._host.shadowRoot?this._host.shadowRoot.querySelector("slot")?r+="."+t+" "+this._host.localName+" "+e.replace("&gt;",">")+"{"+n.properties+"}":r+=":host"==e?":host(."+t+") {"+n.properties+"}":":host(."+t+") "+e.replace("&gt;",">")+"{"+n.properties+"}":r+="html"===e?e+"."+t+"{"+n.properties+"}":"."+t+" "+e.replace("&gt;",">")+"{"+n.properties+"}"}if(this._head.querySelector("#cssCtxQueriesStyleTag"))this._head.querySelector("#cssCtxQueriesStyleTag").appendChild(document.createTextNode(r));else{let e=document.createElement("style");e.id="cssCtxQueriesStyleTag",e.appendChild(document.createTextNode(r)),this._head.appendChild(e)}}}findClosingBracket(e,t){let n=t.indexOf(e[0],t.indexOf("@context")),r=1;for(;r>0;){let s=t[++n];s==e[0]?r++:s==e[1]&&r--}return n}factoriseContextQueries(e,t){if(e.includes("@context")){let n=e.substring(e.indexOf("@context"),this.findClosingBracket("{}",e)+1),r=e.replace(n,"");r=r.trim(),this._arrayOfQueries.push(n),this.factoriseContextQueries(r,t)}else{0!=t&&this._arrayOfQueries.push("@context "+t+" {"+e+"}");let n=[];for(let e of this._arrayOfQueries){let t=e.substring(8,e.indexOf("{")),r=[],s=e.substring(e.indexOf("{")+1,e.lastIndexOf("}")).split(/\s*}\s*/);for(let e of s){let t,n,s;t=e.substring(0,e.indexOf("{")),n=e.substring(e.indexOf("{")+1),s=t.split(/\s*,\s*/);for(let e of s){let t={selector:e.trim(),properties:n.trim()};""==t.selector&&""===t.properties||r.push(t)}}n.push({expression:t.trim(),styles:r})}if(0!=t){let e=n[n.length-1].expression;(e.includes("or")||e.includes(","))&&(e="("+e+")");for(let t=0;t<n.length-1;t++)(n[t].expression.includes("or")||n[t].expression.includes(","))&&(n[t].expression="("+n[t].expression+")"),n[t].expression+=" and "+e}this._arrayOfQueries=[];for(let e of n)e.styles.length>0&&this._arrayOfQueries.push(e)}}}document.addEventListener("DOMContentLoaded",function(){window.customElements.define("context-style",s)}),n.d(t,"ContextQuery",function(){return r}),n.d(t,"ContextStyle",function(){return s})}]);
//# sourceMappingURL=context.js.map