window.contextFeatures=[{name:"devicelight",value:null,callback:null},{name:"devicemotion",value:null,callback:null},{name:"deviceproximity",value:null,callback:null},{name:"touch",value:null,callback:function(){return!!("ontouchstart"in window||navigator.maxTouchPoints)}},{name:"time",value:null,callback:function(){return!0}},{name:"battery",value:null,callback:function(){return!0}}],function(){for(feature of window.contextFeatures)null==feature.callback?"on"+feature.name in window?feature.supported=!0:feature.supported=!1:feature.supported=feature.callback();console.log(window.contextFeatures)}();class ContextQueryList{constructor(e,t,s=""){this.context=e,this.onchange=null,this._private={listeners:{},host:t,selectors:s,queries:this._breakQueriesDown(),class:"css-ctx-queries-"+(+new Date).toString(36)},this.matches=this._determineMatch(),this._registerListeners()}_registerListeners(){window.addEventListener("devicelight",e=>{let t=e.value/10;this._performContextCheck("devicelight",Math.round(t))}),this._performContextCheck("time",60*(new Date).getHours()+(new Date).getMinutes()),setInterval(()=>{this._performContextCheck("time",60*(new Date).getHours()+(new Date).getMinutes())},1e3)}_performContextCheck(e,t){for(let s of window.contextFeatures)s.name==e&&(s.value=t);this._determineMatch(),0!=this._private.host&&(this.matches?this._private.host.classList.contains(this._private.class)||this._private.host.classList.add(this._private.class):this._private.host.classList.contains(this._private.class)&&this._private.host.classList.remove(this._private.class))}addEventListener(e,t){e in this._private.listeners||(this._private.listeners[e]=[]),this._private.listeners[e].push(t)}addListener(e){this.addEventListener("change",e)}removeEventListener(e,t){if(!(e in this._private.listeners))return;let s=this._private.listeners[e];for(let e in s)if(console.log(s[e]),s[e].toString()===t.toString())return void s.splice(e,1)}removeListener(e){this.removeEventListener("change",e)}dispatchEvent(e){if(!(e.type in this._private.listeners))return!0;let t=this._private.listeners[e.type];for(let s of t)s.call(this,e);return!e.defaultPrevented}set onchange(e){"function"==typeof e&&(this.removeEventListener("change",this.onchange),onchange=e,this.addEventListener("change",e))}get onchange(){return onchange}_breakQueriesDown(){function e(e,t,s){if(2==e.length){let i,r,n=!1;for(let s in e)e[s].includes(t)&&(r=e[s],e.splice(s,1),0==s&&(n=!0));void 0!=r&&(i=r.split(t),n?(e.unshift(i[1]),e.unshift(i[0]),"&lt;"===t?s.left=!0:s.right=!0):(e.push(i[0]),e.push(i[1]),"&lt;"===t?s.right=!0:s.left=!0))}}let t=[],s=/\s*,\s*|\s*or\s*/i,i=this.context.split(s);for(let s of i){let i=[],r=s.split(/\s*and\s*/i);for(let t of r){let s,r,n=t.substring(t.indexOf("(")+1,t.indexOf(")")),a={},l={left:!1,right:!1};if(t.includes("<")||t.includes(">")){if(n.includes("<")&&n.includes(">"))return void console.error("you have mixed the greater than and less than symbol in an expression!");n.includes("<")&&(n.includes("<=")?e(s=n.split("<="),"<",l):(s=n.split("<"),l={left:!0,right:!0}),2==s.length?s[0].includes("%")||!isNaN(s[0])?(a.min=parseFloat(s[0]),a.feature=s[1].trim()):(a.max=parseFloat(s[1]),a.feature=s[0].trim()):(a.feature=s[1].trim(),a.min=parseFloat(s[0]),a.max=parseFloat(s[2])),(l.left||l.right)&&(a.lt_gt=l),i.push(a)),n.includes(">")&&(n.includes(">=")?e(s=n.split(">="),">",l):(s=n.split(">"),l={left:!0,right:!0}),2==s.length?s[0].includes("%")||!isNaN(s[0])?(a.max=parseFloat(s[0]),a.feature=s[1].trim()):(a.min=parseFloat(s[1]),a.feature=s[0].trim()):(a.feature=s[1].trim(),a.max=parseFloat(s[0]),a.min=parseFloat(s[2])),(l.left||l.right)&&(a.lt_gt=l),i.push(a))}else if(t.includes(":")){let e,s,n;if(e=t.substring(t.indexOf("(")+1,t.indexOf(")")),s=e.split(/\s*:\s*/),r=s[0].trim(),a.feature=r,n=parseFloat(s[1]),r.includes("min-")||r.includes("max-"))if(r=r.replace("min-",""),r=r.replace("max-",""),a.feature=r,0==i.length)s[0].includes("min-")&&(a.min=n),s[0].includes("max-")&&(a.max=n),i.push(a);else for(let e of i)e.feature!=a.feature?(s[0].includes("min-")&&(a.min=n),s[0].includes("max-")&&(a.max=n),i.push(a)):(s[0].includes("min-")&&(e.min=n),s[0].includes("max-")&&(e.max=n));else a.abs=n,i.push(a)}else{let e=t.substring(t.indexOf("(")+1,t.indexOf(")"));e&&(a.feature=e,a.abs=!0,i.push(a))}}t.push(i)}return t}_determineMatch(){let e=!1;for(let t of this._private.queries){let s=!0;for(let e of t){let t=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;for(let r of window.contextFeatures)r.name===e.feature&&(e.hasOwnProperty("abs")?Number.isInteger(e.abs)?r.value!=e.abs&&(s=!1):r.value||(s=!1):(e.hasOwnProperty("min")&&(t=e.min),e.hasOwnProperty("max")&&(i=e.max),e.hasOwnProperty("lt_gt")&&(e.lt_gt.left&&++t,e.lt_gt.right&&--i),t==-1/0&&i==1/0||(r.value<t||i<r.value)&&(s=!1)))}s&&(e=!0)}if(e!=this.matches){if(void 0==this.matches)return e;this.matches=e,this.dispatchEvent(new CustomEvent("change",{detail:{matches:e,target:this}}))}}}class contextStyle extends HTMLElement{constructor(){super(),this.arrayOfQueries=[],this._host=document.querySelector("html"),this._head=document.querySelector("head")}connectedCallback(){this.style.display="none",void 0!=this.parentNode.host&&(this.parentNode.host.shadowRoot.querySelector("slot")||(this._host=this.parentNode.host,this._head=this._host.shadowRoot)),this.getHrefAttr()}disconnectedCallback(){}getContent(e){let t=this.innerHTML;""!=t.trim()?(t=t.replace(/&gt;/g,">").replace(/&lt;/g,"<"),this.instantiateContextQueryObjects(t.trim(),e)):console.error("Context-Styles have not been declared, please use the href attribute or write them directly in the context-style tag.")}getHrefAttr(){let e=!1;this.hasAttribute("context")&&""!=this.getAttribute("context")&&(e=this.getAttribute("context")),this.hasAttribute("href")&&""!=this.getAttribute("href")?this.getURL(this.getAttribute("href")).then(t=>{this.instantiateContextQueryObjects(t,e)},e=>{console.error("Failed!",e)}):this.getContent(e)}getURL(e){return new Promise(function(t,s){var i=new XMLHttpRequest;i.open("GET",e),i.onload=function(){200==i.status?t(i.response):s(Error(i.statusText))},i.onerror=function(){s(Error("Network Error"))},i.send()})}instantiateContextQueryObjects(e,t){this.factoriseContextQueries(e,t);for(let e of this.arrayOfQueries){let t=new ContextQueryList(e.expression,this._host,e.styles),s="";console.log(t);for(let e of t._private.selectors){let i=e.selector;void 0!=t._private.host.shadowRoot?t._private.host.shadowRoot.querySelector("slot")?s+="."+t._private.class+" "+t._private.host.localName+" "+i.replace("&gt;",">")+"{"+e.properties+"}":s+=":host"==i?":host(."+t._private.class+") {"+e.properties+"}":":host(."+t._private.class+") "+i.replace("&gt;",">")+"{"+e.properties+"}":s+="html"===i?i+"."+t._private.class+"{"+e.properties+"}":"."+t._private.class+" "+i.replace("&gt;",">")+"{"+e.properties+"}"}if(this._head.querySelector("#cssCtxQueriesStyleTag"))this._head.querySelector("#cssCtxQueriesStyleTag").appendChild(document.createTextNode(s));else{let e=document.createElement("style");e.id="cssCtxQueriesStyleTag",e.appendChild(document.createTextNode(s)),this._head.appendChild(e)}}}findClosingBracket(e,t){let s=t.indexOf(e[0],t.indexOf("@context")),i=1;for(;i>0;){let r=t[++s];r==e[0]?i++:r==e[1]&&i--}return s}factoriseContextQueries(e,t){if(e.includes("@context")){let s=e.substring(e.indexOf("@context"),this.findClosingBracket("{}",e)+1),i=e.replace(s,"");i=i.trim(),this.arrayOfQueries.push(s),this.factoriseContextQueries(i,t)}else{0!=t&&this.arrayOfQueries.push("@context "+t+" {"+e+"}");let s=[];for(let e of this.arrayOfQueries){let t=e.substring(8,e.indexOf("{")),i=[],r=e.substring(e.indexOf("{")+1,e.lastIndexOf("}")).split(/\s*}\s*/);for(let e of r){let t,s,r;t=e.substring(0,e.indexOf("{")),s=e.substring(e.indexOf("{")+1),r=t.split(/\s*,\s*/);for(let e of r){let t={selector:e.trim(),properties:s.trim()};""==t.selector&&""===t.properties||i.push(t)}}s.push({expression:t.trim(),styles:i})}if(0!=t){let e=s[s.length-1].expression;for(let t=0;t<s.length-1;t++)s[t].expression+=" and "+e}this.arrayOfQueries=[];for(let e of s)e.styles.length>0&&this.arrayOfQueries.push(e)}}}customElements.define("context-style",contextStyle),window.matchContext=function(e){var t=new ContextQueryList(e,!1);return console.log(t),t};