window.contextFeatures=[{name:"devicelight",value:null,callback:null},{name:"devicemotion",value:null,callback:null},{name:"deviceproximity",value:null,callback:null},{name:"touch",value:null,callback:function(){return!!("ontouchstart"in window||navigator.maxTouchPoints)}},{name:"time",value:null,callback:function(){return!0}},{name:"battery",value:null,callback:function(){return!!navigator.getBattery}},{name:"charging-battery",value:null,callback:function(){return!!navigator.getBattery}}],function(){for(let e of window.contextFeatures)null==e.callback?"on"+e.name in window?e.supported=!0:e.supported=!1:e.supported=e.callback();console.log(window.contextFeatures)}();class ContextQuery{constructor(e){this._onchange=null,this._listeners={},this._queries=this._breakQueriesDown(e),this._intervalID=void 0,this.context=e,this.matches=this._determineMatch(),this._registerListeners()}_registerListeners(){window.addEventListener("devicelight",e=>{let t=e.value/10;this._performContextCheck("devicelight",Math.round(t))}),this._performContextCheck("touch",!!("ontouchstart"in window||navigator.maxTouchPoints)),this._performContextCheck("time",60*(new Date).getHours()+(new Date).getMinutes()),this._intervalID=setInterval(()=>{this._performContextCheck("time",60*(new Date).getHours()+(new Date).getMinutes())},1e3),navigator.getBattery().then(function(e){e.addEventListener("chargingchange",function(){this._performContextCheck("charging-battery",e.charging)}),e.addEventListener("levelchange",function(){this._performContextCheck("battery",100*e.level+"%")})})}_performContextCheck(e,t){for(let s of window.contextFeatures)s.name==e&&(s.value=t);this._determineMatch()}addEventListener(e,t){e in this._listeners||(this._listeners[e]=[]),this._listeners[e].push(t)}addListener(e){this.addEventListener("change",e)}removeEventListener(e,t){if(!(e in this._listeners))return;let s=this._listeners[e];for(let e in s)if(console.log(s[e]),s[e].toString()===t.toString())return void s.splice(e,1)}removeListener(e){this.removeEventListener("change",e)}dispatchEvent(e){if(!(e.type in this._listeners))return!0;let t=this._listeners[e.type];for(let s of t)s.call(this,e);return!e.defaultPrevented}set onchange(e){"function"==typeof e&&(this.removeEventListener("change",this._onchange),this._onchange=e,this.addEventListener("change",e))}get onchange(){return this._onchange}_breakQueriesDown(e){function t(e,t,s){if(2==e.length){let i,n,r=!1;for(let s in e)e[s].includes(t)&&(n=e[s],e.splice(s,1),0==s&&(r=!0));void 0!=n&&(i=n.split(t),r?(e.unshift(i[1]),e.unshift(i[0]),"&lt;"===t?s.left=!0:s.right=!0):(e.push(i[0]),e.push(i[1]),"&lt;"===t?s.right=!0:s.left=!0))}}let s=[],i=/\s*,\s*|\s*or\s*/i,n=e.split(i);for(let e of n){let i=[],n=e.split(/\s*and\s*/i);for(let e of n){let s,n,r=e.substring(e.indexOf("(")+1,e.indexOf(")")),o={},a={left:!1,right:!1};if(e.includes("<")||e.includes(">")){if(r.includes("<")&&r.includes(">"))return void console.error("you have mixed the greater than and less than symbol in an expression!");r.includes("<")&&(r.includes("<=")?t(s=r.split("<="),"<",a):(s=r.split("<"),a={left:!0,right:!0}),2==s.length?s[0].includes("%")||!isNaN(s[0])?(o.min=parseFloat(s[0]),o.feature=s[1].trim()):(o.max=parseFloat(s[1]),o.feature=s[0].trim()):(o.feature=s[1].trim(),o.min=parseFloat(s[0]),o.max=parseFloat(s[2])),(a.left||a.right)&&(o.lt_gt=a),i.push(o)),r.includes(">")&&(r.includes(">=")?t(s=r.split(">="),">",a):(s=r.split(">"),a={left:!0,right:!0}),2==s.length?s[0].includes("%")||!isNaN(s[0])?(o.max=parseFloat(s[0]),o.feature=s[1].trim()):(o.min=parseFloat(s[1]),o.feature=s[0].trim()):(o.feature=s[1].trim(),o.max=parseFloat(s[0]),o.min=parseFloat(s[2])),(a.left||a.right)&&(o.lt_gt=a),i.push(o))}else if(e.includes(":")){let t,s,r;if(t=e.substring(e.indexOf("(")+1,e.indexOf(")")),s=t.split(/\s*:\s*/),n=s[0].trim(),o.feature=n,r=parseFloat(s[1]),n.includes("min-")||n.includes("max-"))if(n=n.replace("min-",""),n=n.replace("max-",""),o.feature=n,0==i.length)s[0].includes("min-")&&(o.min=r),s[0].includes("max-")&&(o.max=r),i.push(o);else for(let e of i)e.feature!=o.feature?(s[0].includes("min-")&&(o.min=r),s[0].includes("max-")&&(o.max=r),i.push(o)):(s[0].includes("min-")&&(e.min=r),s[0].includes("max-")&&(e.max=r));else o.abs=r,i.push(o)}else{let t=e.substring(e.indexOf("(")+1,e.indexOf(")"));t&&(o.feature=t,o.abs=!0,i.push(o))}}s.push(i)}return s}_determineMatch(){let e=!1;for(let t of this._queries){let s=!0;for(let e of t){let t=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;for(let n of window.contextFeatures)n.name===e.feature&&(e.hasOwnProperty("abs")?Number.isInteger(e.abs)?n.value!=e.abs&&(s=!1):n.value||(s=!1):(e.hasOwnProperty("min")&&(t=e.min),e.hasOwnProperty("max")&&(i=e.max),e.hasOwnProperty("lt_gt")&&(e.lt_gt.left&&++t,e.lt_gt.right&&--i),t==-1/0&&i==1/0||(n.value<t||i<n.value)&&(s=!1)))}s&&(e=!0)}if(e!=this.matches){if(void 0==this.matches)return e;this.matches=e,this.dispatchEvent(new CustomEvent("change",{detail:{matches:e,target:this}}))}}}class ContextStyle extends HTMLElement{constructor(){super(),this._arrayOfQueries=[],this._host=document.querySelector("html"),this._head=document.querySelector("head"),this._contextQueryObjectList=[]}connectedCallback(){this.style.display="none",void 0!=this.parentNode.host&&(this.parentNode.host.shadowRoot.querySelector("slot")||(this._host=this.parentNode.host,this._head=this._host.shadowRoot)),this.getHrefAttr()}disconnectedCallback(){for(let e in this._contextQueryObjectList)void 0!=this._contextQueryObjectList[e]._intervalID&&clearInterval(this._contextQueryObjectList[e]._intervalID),this._contextQueryObjectList[e]=null,delete this._contextQueryObjectList[e];for(let e of this._arrayOfQueries)this._host.classList.remove(e.class);this._contextQueryObjectList.length=0}getContent(e){let t=this.innerHTML;""!=t.trim()?(t=t.replace(/&gt;/g,">").replace(/&lt;/g,"<"),this.instantiateContextQueryObjects(t.trim(),e)):console.error("Context-Styles have not been declared, please use the href attribute or write them directly in the context-style tag.")}getHrefAttr(){let e=!1;this.hasAttribute("context")&&""!=this.getAttribute("context")&&(e=this.getAttribute("context")),this.hasAttribute("href")&&""!=this.getAttribute("href")?this.getURL(this.getAttribute("href")).then(t=>{this.instantiateContextQueryObjects(t,e)},e=>{console.error("Failed!",e)}):this.getContent(e)}getURL(e){return new Promise(function(t,s){var i=new XMLHttpRequest;i.open("GET",e),i.onload=function(){200==i.status?t(i.response):s(Error(i.statusText))},i.onerror=function(){s(Error("Network Error"))},i.send()})}instantiateContextQueryObjects(e,t){this.factoriseContextQueries(e,t);for(let e of this._arrayOfQueries){const t="css-ctx-queries-"+(+new Date).toString(36);e.class=t;let s=window.matchContext(e.expression),i="";s.onchange=(e=>{void 0!=typeof e&&console.log(e),s.matches?this._host.classList.contains(t)||this._host.classList.add(t):this._host.classList.contains(t)&&this._host.classList.remove(t)}),s.onchange(),this._contextQueryObjectList.push(s);for(let s of e.styles){let e=s.selector;void 0!=this._host.shadowRoot?this._host.shadowRoot.querySelector("slot")?i+="."+t+" "+this._host.localName+" "+e.replace("&gt;",">")+"{"+s.properties+"}":i+=":host"==e?":host(."+t+") {"+s.properties+"}":":host(."+t+") "+e.replace("&gt;",">")+"{"+s.properties+"}":i+="html"===e?e+"."+t+"{"+s.properties+"}":"."+t+" "+e.replace("&gt;",">")+"{"+s.properties+"}"}if(this._head.querySelector("#cssCtxQueriesStyleTag"))this._head.querySelector("#cssCtxQueriesStyleTag").appendChild(document.createTextNode(i));else{let e=document.createElement("style");e.id="cssCtxQueriesStyleTag",e.appendChild(document.createTextNode(i)),this._head.appendChild(e)}}}findClosingBracket(e,t){let s=t.indexOf(e[0],t.indexOf("@context")),i=1;for(;i>0;){let n=t[++s];n==e[0]?i++:n==e[1]&&i--}return s}factoriseContextQueries(e,t){if(e.includes("@context")){let s=e.substring(e.indexOf("@context"),this.findClosingBracket("{}",e)+1),i=e.replace(s,"");i=i.trim(),this._arrayOfQueries.push(s),this.factoriseContextQueries(i,t)}else{0!=t&&this._arrayOfQueries.push("@context "+t+" {"+e+"}");let s=[];for(let e of this._arrayOfQueries){let t=e.substring(8,e.indexOf("{")),i=[],n=e.substring(e.indexOf("{")+1,e.lastIndexOf("}")).split(/\s*}\s*/);for(let e of n){let t,s,n;t=e.substring(0,e.indexOf("{")),s=e.substring(e.indexOf("{")+1),n=t.split(/\s*,\s*/);for(let e of n){let t={selector:e.trim(),properties:s.trim()};""==t.selector&&""===t.properties||i.push(t)}}s.push({expression:t.trim(),styles:i})}if(0!=t){let e=s[s.length-1].expression;for(let t=0;t<s.length-1;t++)s[t].expression+=" and "+e}this._arrayOfQueries=[];for(let e of s)e.styles.length>0&&this._arrayOfQueries.push(e)}}}document.addEventListener("DOMContentLoaded",function(){window.customElements.define("context-style",ContextStyle)}),window.matchContext=function(e){return new ContextQuery(e)};